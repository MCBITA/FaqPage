!function(){"use strict";angular.module("FaqApp.controllers",[]),angular.module("FaqApp.services",[]),angular.module("FaqApp.directives",[]),angular.module("FaqApp.filters",[]),angular.module("ViewFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","FaqApp.filters","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable","ui.select","angular-sortable-view"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"partials/FaqList.html",controller:"FaqViewCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function($logProvider){$logProvider.debugEnabled(window.faq_is_debug)}]),angular.module("EditFaqApp",["FaqApp.controllers","FaqApp.services","FaqApp.directives","ngRoute","ngSanitize","ngAnimate","ui.bootstrap","ui.sortable","ngToast","ui.select","angular-sortable-view"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"partials/EditMode/FaqEditStartScreen.html",controller:"FaqEditCtrl"}).when("/SelectForEdit",{templateUrl:"partials/EditMode/SelectFaqSetForEdit.html",controller:"SelectFaqForEditCtrl"}).when("/ConnectFaqSet",{templateUrl:"partials/EditMode/ConnectFaqSet.html",controller:"ConnectFaqSetCtrl"}).when("/NewFaqSet",{templateUrl:"partials/EditMode/NewFaqSet.html",controller:"FaqEditCtrl"}).when("/ManageFaqSet/:folderUrl",{templateUrl:"partials/EditMode/ManageFaqSet.html",controller:"ManageFaqSetCtrl"}).when("/ManageFaqSet/:folderUrl/faq/edit/:faqId",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/ManageFaqSet/:folderUrl/faq/new",{templateUrl:"partials/EditMode/CreateEditFaq.html",controller:"CreateEditFaqCtrl"}).when("/Licensing",{templateUrl:"partials/EditMode/LicenseRequest.html",controller:"RegisterAppCtrl"}).when("/ContactDev",{templateUrl:"partials/EditMode/ContactDeveloper.html",controller:"ContactDeveloperCtrl"}).otherwise({redirectTo:"/"})}]).config(["$logProvider",function($logProvider){$logProvider.debugEnabled(window.faq_is_debug)}]).config(["ngToastProvider",function(ngToastProvider){window.parent!==window&&-1!==window.location.href.indexOf("FaqAppPartEditMode.aspx")&&ngToastProvider.configure({horizontalPosition:"center",verticalPosition:"bottom"})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CommonFaqSetSettingsCtrl",["$scope","faqService","processing","$routeParams","$timeout","$jq","animationList","ngToast",function($scope,faqService,processing,$routeParams,$timeout,$jq,animationList,ngToast){processing.initilize($scope);var folder;$scope.viewDeferred=faqService.faqRepository.getRootFolders(),$scope.viewDeferred.then(function(folders){folder=$jq.grep(folders,function(currentFolder){return currentFolder.title===$routeParams.folderUrl?!0:!1})[0],$scope.faqSettings=folder.faqSetSettings,$scope.setSelectedAnimation($scope.faqSettings.animation)}),$scope.setSelectedAnimation=function(name){$scope.selectedAnimation=animationList[name],$scope.playingAnimation=name,$scope.faqSettings.animation=name},$scope.testAnimation=function(){$scope.playingAnimation=$scope.faqSettings.animation},$scope.saveSettings=function(){folder.faqSetSettings=$scope.faqSettings,$scope.viewDeferred=faqService.faqRepository.saveItem(folder),ngToast.create({content:$scope.Resources.DataSaved})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ConnectFaqSetCtrl",["processing","$scope","$q","$jq","faqService","context","ngToast","$timeout",function(processing,$scope,$q,$jq,faqService,context,ngToast,$timeout){processing.initilize($scope);var wpId=context.wpId;$scope.resize=function(){$timeout(function(){faqService.resizeParent()},100)},$scope.selectedFolders=[],$scope.viewDeferred=$q.all([faqService.faqRepository.getRootFolders(),faqService.appPartConfigRepository.getByAppPartId(wpId)]),$scope.viewDeferred.then(function(results){var folders=results[0],config=results[1];config?($scope.searchEnabled=config.configData.searchEnabled,$scope.filterEnabled=config.configData.filterEnabled,$scope.customCssEnabled=config.configData.customCssEnabled,config.configData.customCssLink||(config.configData.customCssLink=context.spAppWebUrl+"Lists/Documents/FaqCustomStyles.css"),$scope.customCssLink=config.configData.customCssLink,
//fix for 1.0.1.2 version
config.configData.folderId&&(config.configData.faqSetInfo=[],config.configData.faqSetInfo.push({order:1,folderId:config.configData.folderId})),
//end fix
Array.forEach(config.configData.faqSetInfo,function(info){var sourceIndex=folders.map(function(folder){return folder.id}).indexOf(info.folderId);if(-1!==sourceIndex){var splicedFolder=folders.splice(sourceIndex,1)[0];splicedFolder.order=info.order,$scope.selectedFolders.push(splicedFolder)}})):$scope.customCssLink=context.spAppWebUrl+"Lists/Documents/FaqCustomStyles.css",$scope.selectedFolders.sort(function(a,b){return a.order-b.order}),$scope.folders=folders,$scope.resize()},function(error){alert(error.message)}),$scope.connectAppPart=function(){faqService.appPartConfigRepository.getByAppPartId(wpId).then(function(config){config||(config=new AppPartConfigListItem,config.wpId=wpId,config.configData={});var faqSetInfo=$scope.selectedFolders.map(function(selectedFolder,index){return{order:index,folderId:selectedFolder.id}});
//fix for 1.0.1.2 version
config.configData.folderId&&delete config.configData.folderId,
//end fix
config.configData.faqSetInfo=faqSetInfo,config.configData.searchEnabled=$scope.searchEnabled,config.configData.filterEnabled=$scope.filterEnabled,config.configData.customCssEnabled=$scope.customCssEnabled,config.configData.customCssLink=$scope.customCssLink,faqService.appPartConfigRepository.saveItem(config).then(function(){ngToast.create({content:$scope.Resources.DataSaved,horizontalPosition:"center",verticalPosition:"bottom"}),$scope.$apply()},function(error){alert(error.message)})},function(error){alert(error.message)})}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ContactDeveloperCtrl",["$scope","processing",function($scope,processing){processing.initilize($scope)}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("CreateEditFaqCtrl",["$scope","$sce","$routeParams","$q","faqService","processing","ngToast",function($scope,$sce,$routeParams,$q,faqService,processing,ngToast){function initModel(){$scope.faqItem=faqItem,$scope.$watch("faqItem.question",function(){$scope.question=$scope.getInnerText(faqItem.question)}),$scope.$watch("faqItem.answer",function(){$scope.answer=$scope.getInnerText(faqItem.answer)}),$scope.saveFaq=function(){if($scope.submitted=!0,!$scope.faqForm.$invalid){var deferred=$q.defer();$scope.viewDeferred=deferred.promise,faqService.faqRepository.getLastItem().then(function(item){faqItem.order||(faqItem.order=item?item.id+1:1),faqService.faqRepository.saveItem(faqItem).then(function(){ngToast.create({content:$scope.Resources.QuestionSaved}),deferred.resolve(),$scope.go(String.format("/ManageFaqSet/{0}",$routeParams.folderUrl))},function(error){deferred.resolve(),alert(error.message)})},function(error){deferred.resolve(),alert(error.message)})}},$scope.back=function(){$scope.go(String.format("/ManageFaqSet/{0}",$routeParams.folderUrl))}}processing.initilize($scope);var faqItem;faqService.faqRepository.folder=$routeParams.folderUrl,
//edit mode
$routeParams.faqId?
//if item is not requested yet
faqService.faqRepository.getItemById(parseInt($routeParams.faqId,10)).then(function(item){faqItem=item,initModel(),$scope.$apply()},function(error){alert(error.message)}):(// new mode
faqItem=new FaqListItem,faqItem.expanded=!0,initModel())}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqEditCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","context",function($scope,$sce,faqService,$location,faqSetModel,processing,context){processing.initilize($scope),faqSetModel.faqSetName="",$scope.faqSetModel=faqSetModel,$scope.wpIdProvided=!!context.wpId,$scope.newFaqSet=function(){$scope.submitted=!0,$scope.faqForm.$invalid||($scope.createFolderDeferred=faqService.faqRepository.createFaqFolder(faqSetModel.faqSetName,{useAnimation:!1,showPlusSymbol:!0,animation:"cshow"}),$scope.createFolderDeferred.then(function(){$scope.go(String.format("/ManageFaqSet/{0}",faqSetModel.faqSetName)),$scope.$apply()},function(error){$scope.folderExists=error.errorCode===FAQ.ErrorCodes.FolderAlreadyExists,$scope.illegalCharacter=error.errorCode===FAQ.ErrorCodes.IllegalName,$scope.folderExists||$scope.illegalCharacter||($scope.commonError=!0,$scope.errorMessage=error.message),$scope.$apply()}))}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("FaqViewCtrl",["$scope","$sce","$q","$timeout","faqService","processing","context","$log","$window","$jq",function($scope,$sce,$q,$timeout,faqService,processing,context,$log,$window,$jq){processing.initilize($scope);var resizeAttempts=2,resizeTimeOut=200;if($scope.selectedFolders={},$scope.selectedFolders.folders=[],$scope.faqItems=null,$scope.appPartInitialized=!0,context.editMode){var editPageUrl=String.format("{0}FaqAppPartEditMode.aspx{1}#/ConnectFaqSet",context.spAppWebUrl,$window.location.search);return $log.debug(editPageUrl),void($window.location.href=editPageUrl)}var wpId=context.wpId,deferred=$q.defer();$scope.viewDeferred=deferred.promise,$scope.changeVisibility=function(faqItem,repeatScope){repeatScope.forceExpand||(repeatScope.playingAnimation=repeatScope.$parent.faqFolder.faqSetSettings.animation,faqItem.isShown=!faqItem.isShown,faqItem.expanded=!faqItem.expanded)},$scope.clearSearch=function(){$scope.searchText&&($scope.searchText="",$timeout(function(){faqService.resizeParent()},100))},$scope.filterByQuestionAnswer=function(faq){if(!$scope.searchText)return!0;var toSearch=$scope.searchText.toLowerCase();return-1!==faq.question.toLowerCase().indexOf(toSearch)||-1!==faq.answer.toLowerCase().indexOf(toSearch)},$scope.filterBySelectedFolders=function(folder){if(0===$scope.selectedFolders.folders.length)return!0;var filteredFolder=$jq.grep($scope.selectedFolders.folders,function(searchFolder){return folder.id===searchFolder.id});return 1===filteredFolder.length},$scope.resize=function(){$timeout(function(){faqService.resizeParent()},100)},$scope.initScope=function(faqFolder,$repeatScope){$repeatScope.playingAnimation=faqFolder.faqSetSettings.animation,$repeatScope.showPlusSymbol=faqFolder.faqSetSettings.showPlusSymbol,$repeatScope.forceExpand=faqFolder.faqSetSettings.useAnimation===!1},faqService.appPartConfigRepository.getByAppPartId(wpId).then(function(config){config?(
//fix for 1.0.1.2 version
config.configData.folderId&&(config.configData.faqSetInfo=[],config.configData.faqSetInfo.push({order:1,folderId:config.configData.folderId})),
//end fix
$scope.customCssEnabled=config.configData.customCssEnabled,$scope.customCssLink=config.configData.customCssLink,$scope.$apply(),faqService.faqRepository.getItemsByIds(config.configData.faqSetInfo.map(function(info){return info.folderId})).then(function(loadedFolders){$log.debug(loadedFolders),faqService.faqRepository.getItemsInsideFolders(loadedFolders.map(function(folder){return folder.title})).then(function(items){$log.debug(items),Array.forEach(items,function(item){item.isShown=item.expanded}),Array.forEach(loadedFolders,function(currentFolder){var folderItems=$jq.grep(items,function(faqItem){if(!faqItem.fileDirRef||!currentFolder.title)return!1;var lastIndex=faqItem.fileDirRef.lastIndexOf("/"),faqItemFolderName=faqItem.fileDirRef.substring(lastIndex+1,faqItem.fileDirRef.length).toLowerCase();return faqItemFolderName===currentFolder.title.toLowerCase()?!0:!1}),configFolder=$jq.grep(config.configData.faqSetInfo,function(info){return info.folderId===currentFolder.id?!0:!1})[0];currentFolder.faqItems=folderItems,currentFolder.order=configFolder.order}),$scope.showSearch=config.configData.searchEnabled,$scope.showFilter=config.configData.filterEnabled,$scope.loadedFolders=loadedFolders,$scope.faqItems=items,deferred.resolve(),$scope.$apply(),faqService.resizeParent(),$log.debug("faqService.resizeParent()");var resizeInterval=setInterval(function(){resizeAttempts--,0===resizeAttempts&&clearInterval(resizeInterval),faqService.resizeParent(),$log.debug("faqService.resizeParent() - interval")},1*resizeTimeOut)},function(error){deferred.resolve(),alert(error.message)})},function(error){deferred.resolve(),alert(error.message)})):($scope.appPartInitialized=!1,deferred.resolve(),$scope.$apply())},function(error){deferred.resolve(),alert(error.message)})}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ManageFaqSetCtrl",["$scope","$sce","faqService","$location","faqSetModel","processing","$modal","$routeParams",function($scope,$sce,faqService,$location,faqSetModel,processing,$modal,$routeParams){processing.initilize($scope),faqSetModel.faqSetName=$routeParams.folderUrl,$scope.faqSetModel=faqSetModel,$scope.activeTab="tab1",faqService.faqRepository.folder=$routeParams.folderUrl,$scope.viewDeferred=faqService.faqRepository.getOrderedItems(),$scope.viewDeferred.then(function(items){Array.forEach(items,function(item){item.isShown=item.expanded}),$scope.faqItems=items,$scope.$apply()},function(error){alert(error.message)}),$scope.newFaq=function(){$scope.go(String.format("/ManageFaqSet/{0}/faq/new",$routeParams.folderUrl))},$scope.editFaq=function(faqItem){$scope.go(String.format("/ManageFaqSet/{0}/faq/edit/{1}",$routeParams.folderUrl,faqItem.id))},$scope.deleteFaq=function(faqItem){var modalInstance=$modal.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});modalInstance.result.then(function(){$scope.viewDeferred=faqService.faqRepository.deleteItem(faqItem),$scope.viewDeferred.then(function(){var indexToRemove=-1;Array.forEach($scope.faqItems,function(item,index){return item.id===faqItem.id?void(indexToRemove=index):void 0}),indexToRemove>-1&&$scope.faqItems.splice(indexToRemove,1),$scope.$apply()},function(error){alert(error.message)})},function(){})},$scope.sortableOptions={placeholder:"sortable-placeholder",stop:function(){Array.forEach($scope.faqItems,function(item,index){item.order=index}),$scope.viewDeferred=faqService.faqRepository.updateOrdering($scope.faqItems),$scope.viewDeferred.then(function(){},function(error){alert(error.message)})}}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("ModalInstanceCtrl",["$modalInstance","$scope","processing","$location",function($modalInstance,$scope,processing){processing.initilize($scope),$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("RootCtrl",["$scope","$location","processing","context","$window",function($scope,$location,processing,context,$window){processing.initilize($scope),$scope.navigateToReview=function(){var url=String.format("https://store.office.com/writereview.aspx?assetid={0}",context.assetId);$window.open(url,"_blank")}}])}(),function(){"use strict";angular.module("FaqApp.controllers").controller("SelectFaqForEditCtrl",["processing","$scope","faqService","$modal","$jq",function(processing,$scope,faqService,$modal,$jq){processing.initilize($scope),$scope.viewDeferred=faqService.faqRepository.getRootFolders(),$scope.viewDeferred.then(function(folders){$scope.folders=folders,faqService.faqRepository.folder=null,$scope.$apply()},function(error){alert(error.message)}),$scope.editFaqSet=function(folder){$scope.go(String.format("/ManageFaqSet/{0}",folder.title))},$scope.deleteFaqSet=function(folder){var modalInstance=$modal.open({templateUrl:"deleteFaqModal.html",controller:"ModalInstanceCtrl",size:"sm"});modalInstance.result.then(function(){$scope.viewDeferred=faqService.faqRepository.deleteItem(folder),$scope.viewDeferred.then(function(){var indexToRemove=-1;Array.forEach($scope.folders,function(currentFolder,index){return currentFolder.id===folder.id?void(indexToRemove=index):void 0}),indexToRemove>-1&&$scope.folders.splice(indexToRemove,1),$scope.$apply()},function(error){alert(error.message)})},function(){})},$scope.revertFolderName=function($repeatScope,folder){folder.title=folder.initialName,$repeatScope.changed=$repeatScope.submitted=!1},$scope.initScope=function($repeatScope,folder){folder.initialName=folder.title,$repeatScope.$watch("folder.title",function(){$repeatScope.folder.fileLeafRef=$repeatScope.folder.title})},$scope.changeFolderName=function($repeatScope,folder){if($repeatScope.submitted=!0,!$repeatScope.faqSetForm.$invalid){var hasDuplicateName=$jq.grep($repeatScope.folders,function(currentFolder){return currentFolder.id===folder.id&&currentFolder!=folder?!0:!1}).length>0;if(hasDuplicateName)return void($repeatScope.folderExists=!0);$scope.viewDeferred=faqService.faqRepository.saveItem(folder),$scope.viewDeferred.then(function(){folder.initialName=folder.title,$repeatScope.changed=$repeatScope.submitted=!1,$scope.$apply()},function(error){$repeatScope.folderExists=error.errorCode===FAQ.ErrorCodes.FolderAlreadyExists,$repeatScope.illegalCharacter=error.errorCode===FAQ.ErrorCodes.IllegalName,$repeatScope.folderExists||$repeatScope.illegalCharacter||($repeatScope.commonError=!0,$repeatScope.errorMessage=error.message),$scope.$apply()})}}}])}(),function($){"use strict";angular.module("FaqApp.directives").directive("block",["$log",function($log){return $.blockUI.defaults.css={},$.blockUI.defaults.overlayCSS.backgroundColor="#FFF",$.blockUI.defaults.overlayCSS.cursor="default",{retstrict:"A",scope:{lock:"=block"},link:function($scope,element){$scope.$watch("lock",function(){$scope.lock&&angular.isFunction($scope.lock["finally"])&&($log.debug("Blocking..."),element.addClass("locked").block({message:"<img src='Content/img/ajax-loader.gif'>"}),$scope.lock["finally"](function(){$log.debug("Unblocking..."),element.removeClass("locked").unblock()}))})}}}])}(jQuery),function(){"use strict";angular.module("FaqApp.directives").directive("contenteditable",[function(){return{require:"ngModel",link:function($scope,element,attrs,ngModel){
// view -> model
element.on("blur",function(){$scope.$apply(function(){ngModel.$setViewValue(element.html())})}),
// model -> view
ngModel.$render=function(){element.html(ngModel.$viewValue)},ngModel.$render()}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("faqAnimate",["$timeout",function($timeout){return{retstrict:"A",scope:{animatationName:"="},link:function($scope,element){$scope.$watch("animatationName",function(name,oldName){if(name!==oldName&&name){var className;className="cshow"===name?"ng-hide":"animated "+name,element.addClass(className),setTimeout(function(){element.removeClass(className)},1500)}$timeout(function(){$scope.animatationName=""},100)})}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("faqShow",["$animate","faqService","$log",function($animate,faqService,$log){return{retstrict:"A",scope:{faqShow:"=",animatationName:"="},link:function($scope,element){$scope.$watch("faqShow",function(show,oldShow){show!==oldShow&&(show?(element.removeClass("ng-hide"),faqService.resizeParent(),element.addClass("animated "+$scope.animatationName),$log.debug("addClass"),setTimeout(function(){element.removeClass("animated "+$scope.animatationName)},1e3)):(element.addClass("ng-hide"),
//element.removeClass("animated");
//element.removeClass($scope.animatationName);
faqService.resizeParent()))})}}}])}(),function(){"use strict";angular.module("FaqApp.directives").directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}})}(),function(){"use strict";angular.module("FaqApp.directives").directive("spEditable",[function(){return{restrict:"A",scope:{},link:function($scope,element){element.addClass("ms-rte-layoutszone-inner-editable ms-rtestate-write").attr("role","textbox").attr("aria-haspopup","true").attr("contentEditable","true").attr("aria-autocomplete","both").attr("aria-autocomplete","both").attr("aria-multiline","true")}}}])}(),function(){"use strict";angular.module("FaqApp.filters").filter("faqhighlight",["$sce",function($sce){return function(text,phrase){return phrase&&(text=text.replace(new RegExp(phrase,"gi"),"<span class='highlighted'>$&</span>")),$sce.trustAsHtml(text)}}])}(),function(){"use strict";angular.module("FaqApp.filters").filter("propsFilter",["$sce",function(){return function(items,props){var out=[];
// Let the output be the input untouched
return angular.isArray(items)?items.forEach(function(item){for(var itemMatches=!1,keys=Object.keys(props),i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().replace(/<[^>]+>/gm,"").toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)}):out=items,out}}])}(),function(){"use strict";var animations={};animations.cshow=FAQRS.SimpleAnimation,animations.fadeIn=FAQRS.FadeIn,animations.fadeInUp=FAQRS.FadeInUp,animations.fadeInRight=FAQRS.FadeInRight,animations.fadeInLeft=FAQRS.FadeInLeft,animations.fadeInDown=FAQRS.FadeInDown,animations.bounceIn=FAQRS.BounceIn,animations.bounceInLeft=FAQRS.BounceInLeft,animations.bounceInRight=FAQRS.BounceInRight,animations.bounceInUp=FAQRS.BounceInUp,animations.bounceInDown=FAQRS.BounceInDown,animations.flip=FAQRS.Flip,animations.flipInX=FAQRS.FlipInX,animations.flipInY=FAQRS.FlipInY,animations.rotateIn=FAQRS.RotateIn,animations.rotateInDownLeft=FAQRS.RotateInDownLeft,animations.rotateInDownRight=FAQRS.RotateInDownRight,animations.rotateInUpLeft=FAQRS.RotateInUpLeft,animations.rotateInUpRight=FAQRS.RotateInUpRight,animations.zoomIn=FAQRS.ZoomIn,animations.zoomInUp=FAQRS.ZoomInUp,animations.zoomInRight=FAQRS.ZoomInRight,animations.zoomInLeft=FAQRS.ZoomInLeft,animations.zoomInDown=FAQRS.ZoomInDown,animations.pulse=FAQRS.Pulse,animations.swing=FAQRS.Swing,animations.tada=FAQRS.Tada,animations.lightSpeedIn=FAQRS.LightSpeedIn,animations.rollIn=FAQRS.RollIn,animations.wobble=FAQRS.Wobble,angular.module("FaqApp.services").value("animationList",animations)}(),function(){"use strict";angular.module("FaqApp.services").factory("context",[function(){function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))}function getWebUrl(key){var webUrl=getParameterByName(key);return webUrl.endsWith("/")?webUrl:webUrl+"/"}var editModeValue=getParameterByName("editmode"),editMode=!1;return editModeValue&&(editMode=!!parseInt(editModeValue,10)),{editMode:editMode,spHostUrl:getWebUrl("SPHostUrl"),spAppWebUrl:getWebUrl("SPAppWebUrl"),wpId:getParameterByName("wpId"),senderId:getParameterByName("SenderId"),isDebug:window.faq_is_debug,productId:window.faq_product_id,assetId:"WA104379252"}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("faqService",["context",function(context){return{appPartConfigRepository:new AppPartsConfigRepository(FAQ.Lists.AppPartsConfigUrl),faqRepository:new FaqRepository(FAQ.Lists.FaqUrl),webService:FAQ.SPWebService,resizeParent:function(){if(window.parent!==window){var $app=$jq("#ng-app-FaqApp"),message="<Message senderId="+context.senderId+" >resize("+($app.outerWidth()+30)+","+($app.outerHeight()+30)+")</Message>";window.parent.postMessage(message,context.spHostUrl)}}}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("faqSetModel",[function(){return{faqSetName:""}}])}(),function(){"use strict";angular.module("FaqApp.services").factory("$jq",function(){return window.jQuery})}(),function(){"use strict";angular.module("FaqApp.services").value("licenseStatus",{UnderTrial:1,Licensed:2,TrialExpired:3,LicenseNotValid:4}),angular.module("FaqApp.services").value("entitlementType",{Free:"free",Paid:"paid",Trial:"trial"}),angular.module("FaqApp.services").factory("licensing",["context","faqService","$q","licenseStatus","storage","$jq","entitlementType","$log",function(context,faqService,$q,licenseStatus,storage,$jq,entitlementType,$log){function validateToken(xmlToken){var token=$jq.xml2json(xmlToken).VerifyEntitlementTokenResponse;token.IsValid="true"===token.IsValid.toLowerCase(),token.IsEntitlementExpired="true"===token.IsEntitlementExpired.toLowerCase(),token.IsExpired="true"===token.IsExpired.toLowerCase(),$log.debug(token);var entitlementTypeReceived=token.EntitlementType.toLowerCase();
//TODO: Uncomment for release!
if(!token.IsValid||token.IsExpired)return void deferred.resolve({status:licenseStatus.LicenseNotValid,assetId:context.assetId});switch(entitlementTypeReceived){case entitlementType.Paid:deferred.resolve({status:licenseStatus.Licensed,assetId:context.assetId});break;case entitlementType.Free:deferred.resolve({status:licenseStatus.Licensed,assetId:context.assetId});break;case entitlementType.Trial:if(token.IsEntitlementExpired){deferred.resolve({status:licenseStatus.TrialExpired,assetId:context.assetId});break}var dateNow=moment(),dateExpiration=moment(token.EntitlementExpiryDate);deferred.resolve({status:licenseStatus.UnderTrial,daysLeft:dateExpiration.diff(dateNow,"days"),assetId:context.assetId})}}function retriveToken(){var ctx=SP.ClientContext.get_current(),licenseCollection=SP.Utilities.Utility.getAppLicenseInformation(ctx,context.productId),tokenDeferred=$q.defer();return ctx.executeQueryAsync(function(){var topLicense,encodedTopLicense;if(licenseCollection.get_count()>0){topLicense=licenseCollection.get_item(0).get_rawXMLLicenseToken(),encodedTopLicense=encodeURIComponent(topLicense);var request=new SP.WebRequestInfo;request.set_url(verificationServiceEndpoint+encodedTopLicense),request.set_method("GET");var response=SP.WebProxy.invoke(ctx,request);ctx.executeQueryAsync(function(){var xmlToken=response.get_body();tokenDeferred.resolve(xmlToken)},function(sender,error){tokenDeferred.reject(new RequestError(error))})}else tokenDeferred.resolve(null)},function(sender,error){tokenDeferred.reject(new RequestError(error))}),tokenDeferred.promise}var tokenKey="faq_token",licenseKey="_faq_license_",deferred=$q.defer(),tokenExpirationInMin=60,verificationServiceEndpoint="https://verificationservice.officeapps.live.com/ova/verificationagent.svc/rest/verify?token=";return{getLicenseStatus:function(){
//fix for previous installations
return faqService.webService.webProperties.get(licenseKey).then(function(license){if(license)//previous install, skip license verification
deferred.resolve({status:licenseStatus.Licensed,assetId:context.assetId});else{//normal paid install
var licenseToken=storage.load(tokenKey);licenseToken?validateToken(licenseToken):retriveToken().then(function(token){token?(storage.save(tokenKey,token,tokenExpirationInMin),validateToken(token)):deferred.resolve({status:licenseStatus.LicenseNotValid,assetId:context.assetId})},function(error){deferred.reject(error)})}},function(error){deferred.reject(error)}),deferred.promise}}}])}(),function($){"use strict";angular.module("FaqApp.services").factory("processing",["$sce","$location","faqService",function($sce,$location,faqService){return{initilize:function($scope){$scope.Resources=FAQRS,$scope.trustedHtml=function(input){return $sce.trustAsHtml(input)},$scope.go=function(path){$location.path(path)},$scope.resizeParent=faqService.resizeParent,$scope.getInnerText=function(html){return $(String.format("<div>{0}</div>",html)).text().trim()}}}}])}(jQuery),function(){"use strict";angular.module("FaqApp.services").factory("storage",function(){return{save:function(key,data,expirationInMin){var expirationMS=60*expirationInMin*1e3,record={value:JSON.stringify(data),timestamp:(new Date).getTime()+expirationMS},dataToStore=LZString.compressToUTF16(JSON.stringify(record));return localStorage.setItem(key,dataToStore),data},load:function(key){var jsonData=LZString.decompressFromUTF16(localStorage.getItem(key));if(!jsonData)return!1;var record=JSON.parse(jsonData);return(new Date).getTime()<record.timestamp&&JSON.parse(record.value)}}})}();
//# sourceMappingURL=faq.app.tmp.min.js.map